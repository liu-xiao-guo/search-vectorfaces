
## What is VectorFaces?

VectorFaces is a real-time face recognition demo that searches through **318,526 celebrity face embeddings** using Elasticsearch vector similarity search. Point your webcam or upload a photo, and it instantly finds matching faces using 512-dimensional embeddings generated by InsightFace.

The demo runs **four quantization methods in parallel**, letting you compare their performance directly:

- **BBQ (Better Binary Quantization)** - Elasticsearch's binary quantization with high recall
- **DiskBBQ** - BBQ optimized for disk storage
- **int8** - 8-bit integer quantization
- **int4** - 4-bit quantization for maximum compression

Each method compresses the 512-dimensional embeddings differently, with different tradeoffs between accuracy, speed, and storage.

## Setup

### 1. Create Your Elasticsearch Cluster

Create a cluster in [Elastic Cloud](https://cloud.elastic.co/home) or use [start-local](https://github.com/elastic/start-local).

Recommended: Use a production tier to handle 318K+ embeddings efficiently.

![Elastic Cloud Setup](doc/image.png)

### 2. Create the Indices

With your Elasticsearch endpoint and API key, run setup to create the four indices:

```bash
pip install elasticsearch

python setup.py \
  --es_url https://your-deployment.us-west2.gcp.elastic-cloud.com:443 \
  --es_apikey your-api-key
```

This creates:
- `faces-bbq_hnsw-12-10`
- `faces-disk_bbq-12-10`
- `faces-int8_hnsw-12-10`
- `faces-int4_hnsw-12-10`

### 3. Index the Data

Download the [index dump](https://storage.googleapis.com/faces-dataset/vectorfaces-index-dump.tar.gz) (318,526 celebrity face embeddings) and extract it.

**Option A: Index Each Method**

```bash
python index.py faces-bbq_hnsw-12-10 \
  --es_url https://your-deployment.us-west2.gcp.elastic-cloud.com:443 \
  --es_apikey your-api-key

python index.py faces-disk_bbq-12-10 \
  --es_url https://your-deployment.us-west2.gcp.elastic-cloud.com:443 \
  --es_apikey your-api-key

python index.py faces-int8_hnsw-12-10 \
  --es_url https://your-deployment.us-west2.gcp.elastic-cloud.com:443 \
  --es_apikey your-api-key

python index.py faces-int4_hnsw-12-10 \
  --es_url https://your-deployment.us-west2.gcp.elastic-cloud.com:443 \
  --es_apikey your-api-key
```

**Option B: Index Once, Reindex to Others**

Index BBQ first, verify all 318,526 documents are indexed, then reindex to the other indices.

Open **Kibana > Dev Tools** and run:

```
POST _reindex?requests_per_second=-1
{
  "source": {
    "index": "faces-bbq_hnsw-12-10"
  },
  "dest": {
    "index": "faces-int8_hnsw-12-10"
  }
}

POST _reindex?requests_per_second=-1
{
  "source": {
    "index": "faces-bbq_hnsw-12-10"
  },
  "dest": {
    "index": "faces-disk_bbq-12-10"
  }
}

POST _reindex?requests_per_second=-1
{
  "source": {
    "index": "faces-bbq_hnsw-12-10"
  },
  "dest": {
    "index": "faces-int4_hnsw-12-10"
  }
}
```

## Run the Demo

Configure `env.local` with your Elasticsearch credentials:

```bash
ES_HOST=https://your-deployment.us-west2.gcp.elastic-cloud.com:443
ES_API_KEY=your-api-key
ES_INDEX=faces-bbq_hnsw-12-10  # Switch between indices to test different methods
```

Start the application:

```bash
docker-compose up
```

Open `http://localhost:16700` and start testing!

## What to Compare

Switch between the four indices and observe:
- **Search latency** - Response times for each quantization method
- **Match quality** - Do results differ between methods?
- **Resource usage** - Index sizes and memory in Kibana monitoring

BBQ typically balances accuracy and compression well, while int4 provides maximum space savings with acceptable recall.